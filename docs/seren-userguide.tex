\documentclass[a4paper]{article}
\usepackage{txfonts}
\usepackage[scaled=0.85]{luximono}
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{supertabular}
\usepackage{array}
\usepackage[latex2html,colorlinks,final]{hyperref}

\newcommand{\VERNO}{1.5.1 }
\newcommand{\var}[1]{\texttt{#1}}

\textheight 9.2in 
\textwidth 6.2in
\oddsidemargin 0pt
\topmargin -40pt

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

\title{SEREN - Version 1.5.1}
\author{David Hubber, Christopher Batty \& Andrew McLeod}

\maketitle

%\newpage
\tableofcontents

\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Overview}
SEREN is a Smoothed Particle Hydrodynamics (SPH) code designed for solving self-gravitating hydrodynamical problems in astrophysics, particularly in the fields of star and planet formation.  SEREN largely grew from DRAGON, the star formation SPH code written by Simon Goodwin at Cardiff University, although many routines have significantly diverged from the original DRAGON versions, or have been rewritten from scratch.  SEREN has also been designed to be compatible with DRAGON in its features and file formats. \newline

The basic elements of SEREN can be used to simulate any problem involving hydrodynamics and gravity, but SEREN also contains many specialized features for star formation problems.  The main features present in SEREN \VERNO  include : 
\begin{itemize}
\item Smoothed Particle Hydrodynamics (Standard SPH or conservative 'grad-h' SPH)
\item Self-gravitating SPH / N-body dynamics
\item Isothermal, barotropic or polytropic equations of state
\item Octal-spatial (Barnes-Hut) neighbour-searching and gravity tree
\item Sink particles, using new accretion algorithm of Hubber et al. (2013)
\item Different particle types (gas, inter-cloud, boundary, CDM and dust particles)
\item 1, 2 or 3 dimensions
\item Periodic boundary conditions (independent for each dimension) or spherical wall
\item Ewald method for periodic gravity
\item Hierarchical block timesteps, with neighbour-checking for safety
\item 2nd order Runge-Kutta, Leapfrog-KDK and Leapfrog-DKD and integration schemes
\item Artificial viscosity with Balsara switch, time-dependence and Keplerian pattern-matching
\item Artificial conductivity with switches
\item N-body evolution of sinks using 4th order Hermite integrator at termination of SPH
\item Radiative cooling approximation of Stamatellos et al. (2007), and hybrid flux-limited diffusion method (Forgan et al. 2009)
\item Ionising radiation using HEALPix (Bisbas et al. 2009)
\item Hybrid SPH and 4th-order Hermite N-body algorithm (Hubber et al. 2013)
\item Simple external background gravitational potentials
\item Parallelized using OpenMP
\item Parallelized using MPI (partial implementation, currently in beta-mode)
\item Bash script to run automated batch tests
\item Output compatable with Splash (Price 2007)
\end{itemize}

\noindent Features currently in development, or implemented but not full tested
\begin{itemize}
\item Wind feedback from high-mass stars (Ngoumou \& Hubber)
\item Multiple fluid components and independent EOSs (Hubber)
\end{itemize}


\newpage


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Using SEREN }


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Obtaining SEREN via github}
SEREN is hosted on the github website ({\rm https://github.com/}) which uses the {\it git} ({\rm http://git-scm.com/}) version-control software, written by Linux-kernel author Linus Torvalds.  The SEREN code is held in the github repository \\

{\rm https://github.com/dhubber/seren}, \\  

\noindent and a webpage describing the features of the code, tests and other information can be found at \\

{\rm http://dhubber.github.io/seren/}. \\

\noindent Although you must register to join and use github, the SEREN code itself can be downloaded anonymously.  One advantage of joining github is that it is easier for us to track usage of the code and that it is possible for users to give feedback, such as bug reports or suggested improvements, or share information about the code that can be useful to other users.  Another advantage is that you can use the github desktop manager, which can make downloading and updating the code easier for those who prefer graphical interfaces rather than simple command line interfaces.

In order to download SEREN, you must first install {\it git} on your system.  It is required that the user has {\it git} version 1.6 or later.  If you have version 1.5 or older, it is recommended asking your computer administrator if he/she could update {\it git} to the latest version, since I have noticed that v1.5 does different things with regards to password authentication and therefore the instructions below will be invalid.  For your own computers (e.g. laptops), {\it git} can easily be obtained with package managers such as apt, rpm, etc ..   For Mac users, {\it git} can be obtained with fink or macports.  {\it git} can also be downloaded directly from the {\it git} webpage (http://git-scm.com).

Before downloading the code, either from the command line or using the github programme, you should set the following important variables in order to track your local changes (i.e. what changes are your own, and which changes are made by the authros): \\

\var{git config -\,-global user.name "Your name here"} %\newline

\var{git config -\,-global user.email "Your email address here"} \newline

This creates a file called .gitconfig in your home directory containing this information.  

Once this is done, you can download the code by one of two ways
\begin{itemize}
\item {Anonymous command line download} \\
\noindent First change into the directory you wish to download the code to.  Next, copy the https clone address into the command line as \\

\noindent {\var git clone https://github.com/dhubber/seren.git}

\item {Desktop application download}
\noindent First, register with github and download and install the github desktop application.  Next, go to the SEREN repository webpage and click the 'Clone in desktop' option.  Select the directory you wish to download the code into and then follow the links to the end.
\end{itemize}


\subsubsection{Updating Seren and managing conflicts on the command line}
The SEREN git repository can be updated quite easily with a few commands. 
First, if you have changed any files in the repository (e.g. most likely 
with the Makefile or the params.dat file), then you have to commit your 
changes to the local repository.  This can be done easily using \newline

\var{git commit -am "Message"} \newline

\noindent where "Message" is some status message which is recorded in the git logs.  This command allows git to know the changes you have made to the SEREN files so it can easily be merged with the new version's updates.  The update can now easily be obtained with the same command as above : \newline

\var{git pull origin master} \newline

\noindent with the same password to be entered at the prompt.  If you have changed any part of the SEREN files which have also been changed in a different way by the update, then there will be a conflict and the merging of the two versions cannot proceed automatically.  In this case, you have to intervene manually and resolve the conflict by selecting which version (i.e. your altered version or the new update) you would like to use.  To view which files have a conflict (plus other information about your local repository), simply type \newline

\var{git status} \newline

\noindent Once you have identified which files have conflicts, you have to open each one individually with a text editor, and edit the conflicted regions (which are clearly marked with both versions of the code in conflict) and save with the chosen version.  Once ALL conflicted files have been modified, you can inform your local repository by commiting the new files by again typing \newline

\var{git commit -am "Another message"} \newline

\noindent All conflicts should now be resolved, and you are free to update to any later versions.  Note that you must commit your changes locally and resolve any potential conflicts every time you want to update the code. 
%I note that this is a very simple approach to using git which mimics the style used with subversion.   However, it is possible to use git in a more advanced way using branches to separate development and working copies.  However, I would suggest sticking with the simple approach described above at least until you become familiar with git to use more advanced features.



\subsubsection{Other important commands}
A selected list of important commands that will be needed from time to time : \newline

\var{git log}           : Outputs log of various commits to screen

\var{git log -\,-online}  : Less verbose version of 'git log'

\var{git status}        : Status of local repository, including what has been
                          modified or added, but not commited

\var{git branch}        : Tells you which code branch you are currently on
                         (should always say master)

\var{git diff}          : Displays difference between local files and those in
                          the repository

\var{git gc -\,-aggressive} : Compresses parts of the git repository to reduce the overall size




%\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Compiling and running SEREN}
SEREN has been designed so to be compiled with \var{GNU make}.  
The user must specify a number of compiler options, which are set at the 
head of the Makefile (see Section \ref{SS:MAKEFILE} for more information). 
In order to compile, a compatible compiler must be specified in the 
first line of the Makefile.  
SEREN has been successfully tested on the following operating systems 
and compilers.  
\begin{itemize}
\item GNU/Linux
\begin{itemize}
\item \var{f95}      - NAG f95 compiler (Linux workstations)
\item \var{g95}      - g95 compiler (Linux workstations)
\item \var{gfortran} - GNU Fortran compiler (Linux workstations)
\item \var{ifort}    - Intel Fortran compiler (Merlin cluster)
\item \var{pgf90}    - Portland group Fortran compiler (Coma cluster)
\item \var{pgf95}    - Portland group Fortran compiler (Iceburg cluster)
\end{itemize}
\item Mac OS X (1.4, 1.5, 1.6 \& 1.7)
\begin{itemize}
\item \var{g95}      - g95 compiler
\item \var{gfortran} - GNU Fortran compiler
\item \var{ifort}    - Intel Fortran compiler
\end{itemize}
\end{itemize}
Once all the other Makefile options have been set to their desired values, SEREN is compiled by \var{GNU make} with the command \newline

\var{make [-j N] seren} \newline

\noindent \var{GNU make} will compile the source code of SEREN and produce the executable program \var{seren}.  The optional argument, \var{-j N}, allows parallel compilation on multi-core architecture, where \var{N} is the number of routines to be compiled in parallel at any one time.  Prior to performing a simulation, the user must set all simulation parameters in the file \var{params.dat} (See section \ref{SS:PARAMS} for more information) and provide an initial conditions file in the appropriate format. To run SEREN, the user must type \newline 

\var{./seren} \newline

\noindent SEREN will read in the default parameters file \var{params.dat} before performing the simulation.

%\var{./seren paramsfile} \newline

%\noindent where \var{paramsfile} is an optional argument that is the name of the parameters file to be read when SEREN is run.  If no argument is included, SEREN assumes the default parameters filename \var{params.dat} which is loaded automatically.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Command-line arguments}
SEREN has a number of optional command-line arguments that can be invoked to change the behaviour of the SEREN executable.  The behaviour can depend on several factors, particularly what Makefile options have been invoked while compiling SEREN.

\tablecaption{List of all command-line arguments available in SEREN}
\tablehead{\hline \bf{Argument} & \bf{Behaviour} \\ \hline}
\tabletail{\hline}
\tablelasttail{\hline}
%\begin{figure}
\begin{center}
\begin{supertabular}{|p{4.0cm}|p{8.0cm}|}
-d, -D, -\,-\,debug & SEREN prints out the debug output column data format to screen and then exits without running any simulation. (N.B. The same information is printed to the \var{runid.params} file when a simulation is performed using SEREN) \\ \hline

-\,-\,diag & SEREN prints out the column data format that is used in the diagnostics file to the screen (enabled with DIAGNOSTIC\_OUTPUT = 1 in the Makefile). \\ \hline

-h, -H, -\,-\,help & SEREN prints out all available command-line options \\ \hline

-m, -M & SEREN prints out the Makefile options used to compile the code to screen and then exits without running any simulation.  (N.B. The same Makefile options are printed to the \var{runid.params} file when a simulation is performed using SEREN) \\ \hline

-s, -S, -\,-\,sinks, -\,-\,stars & SEREN prints out the column data format to screen for the sink files. \\ \hline

-v, -V, -\,-\,version & SEREN prints out current version number \\ \hline

paramsfile & SEREN reads the parameters file \var{paramsfile} instead of the default \var{params.dat} \\ \hline

\end{supertabular}
\end{center}
\vspace{1cm}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Restarting simulations}
If a simulation is terminated for some reason, then it can be restarted by simply running SEREN without any modification to the \var{params.dat} file.  Each simulation generates a file \var{runid.restart} which contains the name of the last snapshot to be outputted.  SEREN will search for this file, and if it exists, it will read the snapshot name contained and restart the simulation from that point.  If you do not wish to restart the simulation from this point, but want a fresh run, then you should delete the \var{runid.restart} file.  If you wish to restart a simulation from a different snapshot, you can delete the \var{runid.restart} file and alter some of the parameters in the \var{params.dat} file, such as the \var{restart} logical flag (See Section \ref{SS:PARAMS}).  


\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{SEREN-MPI} \label{SS:MPISEREN}

The SEREN source code also contains an MPI version, SEREN-MPI.  In order to compile SEREN-MPI, one must download and install an implementation of MPI that works on your system.   To date, we have tested SEREN-MPI using the mpich2 (\var{http://http://www.mpich.org}) library at the development stage.  SEREN-MPI has not been fully tested or debugged using other MPI implementations (e.g. openmpi).  Therefore, it is recommended to use mpich2 if possible.  

We note that SEREN-MPI is currently only a partial implementation of all features and is in the beta-testing stage.  Although it has been shown to run for a limited number of test cases, it has not been through an exhaustive list of tests.  Therefore bugs may still (and probably do) exist in the code that can only be identified and fixed through thorough usage, bug-reporting, fixing, updating and re-testing.  We welcome any feedback from users who wish to trial SEREN-MPI to help us fix any problems rapidly.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Compiling and running SEREN-MPI}
In order to compile SEREN-MPI, several extra options must be set in the Makefile.  These options are 
\begin{itemize}
\item MPIF90
\item MPI
\item MPI\_LIBRARY
\end{itemize}
The default values to compile with MPI should be {\var MPIF90 = mpif90}, {\var MPI = 1} and {\var MPI\_LIBRARY = mpich2}.  If the user wishes to compile also with OpenMP, then this flag should also be switched on.  In this mode, the code will run on each local node parallelised with OpenMP, but parallelised using MPI to communicate between nodes.  This mode could potentially have scaling advantages, although this will be determined with more testing of the code. \newline

\var{make} or \var{make seren} \newline

\noindent To run the code \newline

\var{mpiexec -n N ./seren-mpi} \newline

\noindent where {\var N} is the number of tasks that the MPI job will run on. 


\subsubsection{Combining data snapshots with MPI}
Since MPI runs segments of the simulation on different CPU tasks (often on different nodes), it is more efficient during runtime for each task to write its own contribution to the overall simulation to a separate file.  In order for these files to be meaningfully analysed with SPLASH or some other data analysis tool, they must be combined together to a single file per output.  A python script has been written to easily accomplish this with minimal effort, called \var{joinlots.py} which is located in the \var{joinsim} sub-directory.  It may be required to add the pathname of both the main SEREN directory and the \var{joinsim} sub-directory to your \var{PATH} environment variable.  To join all snapshots for a simulation, we simply type : \newline

\var{joinlots.py runid} \newline

\noindent where \var{runid} is the run id of the simulation as chosen in the parameters file.  (N.B. this currently only works with double precision simulations).


\newpage



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Makefile} \label{SS:MAKEFILE}
The head of the Makefile contains the complete list of compilation variables that are available.  Most variables have two or more possible values which must be entered in the Makefile.  If an illegal value is entered, then \var{make} will halt during compilation, or the program will stop during runtime (see the routine \var{/main/sanitycheck.F90}).  The Makefile is technically split into two separate files; \var{Makefile}, which contains the user options, and \var{makefiletail.mk}, which processes all the selected options to compile the code.  The full list of all Makefile variables and possible options is given in the table below. 
\newline

\tablecaption{List of all available Makefile options in SEREN}
\tablehead{\hline \bf{Variable} & \bf{Options} & \\ \hline}
\tabletail{\hline}
\tablelasttail{\hline}
\begin{center}
\begin{supertabular}{|p{4.6cm}|p{4.6cm} p{6.4cm}|}
 F90           & f95      :& NAG f95 compiler (Linux) \\
               & g95      :& free (not gnu) f95 compiler (Linux, Mac OS X)  \\
	       & gfortran :& gnu f95 compiler (Linux, Mac OS X) \\
               & pgf90    :& Portland Group compiler (Coma cluster) \\ 
               & mpif90   :& Portland Group compiler (Coma cluster) \\ 
	       & ifort    :& Intel Fortran compiler (Merlin cluster) \\ \hline

 MPIF90        & mpif90   :& MPI Fortran compiler \\ \hline

 VERSION\_NO   & & Version no. string \\ \hline

 SRCDIR        & & Absolute path of main SEREN directory (default {\var \$(PWD)/src}) \\ \hline

 EXEDIR        & & Absolute path of location for SEREN executable (default {\$(PWD)}) \\ \hline

 OPENMP        & 0 :& Compile as serial code\\
               & 1 :& Compile using OpenMP directives \\ \hline

 MPI           & 0 :& Compile as serial code\\
               & 1 :& Compile with MPI directives \\ \hline

 MPI\_LIBRARY  & mpich2 & Name of MPI library used \\ \hline

 COMPILER\_MODE & 0 :& No optimisation or debugging flags \\
               & STANDARD :& Use standard optimisation flags (-O3 plus inline functions) \\
               & FAST     :& Use fast optimisation flags for increased speed.  (Note that fast math optimisations are potentially unsafe and can lead to floating point errors, even in apparently bug-less code, and therefore should not be used without testing with the required compilation flags.) \\
               & DEBUG    :& Use all available debug flags (e.g. bounds-testing, floating point erros, etc..).  Should be selected when debugging the code using gdb, or another debugger. \\ \hline

 OUTPUT\_LEVEL & 0 :& Output/debug flags switched off \\
               & 1 :& Output/debug flags switched on to level 1 \\
               & 2 :& Output/debug flags switched on to level 2 \\
               & 3 :& Output/debug flags switched on to level 3 \\ \hline

 DIAGNOSTIC\_OUTPUT & 1 :& Print diagnostic information of conserved quantities (e.g. total mass, momentum, energy) to screen (if OUTPUT\_LEVEL > 0) and file ('run\_id.diag') \\
                    & 0 :& Do not compute diagnostic information \\ \hline

 NDIM          & 1 :& One-dimensional \\
               & 2 :& Two-dimensional \\
               & 3 :& Three-dimensional \\ \hline

 PRECISION     & SINGLE :& Single precision for main real variables \\
               & DOUBLE :& Double precision for main real variables \\ \hline

 INFILE\_FORMAT & ALL       :& Include routines to read all possible file formats \\
                & DRAGON    :& Only include DRAGON-format reading routines \\
                & SEREN     :& Only include SEREN-format reading routines \\
                & ASCII     :& Only include column-ASCII format reading routine \\ \hline

 OUTFILE\_FORMAT & ALL       :& Include routines to write all possible file formats \\
                 & DRAGON    :& Only include DRAGON-format writing routines \\
                 & SEREN     :& Only include SEREN-format writing routines \\ 
                 & ASCII     :& Only include column-ASCII format writing routine \\ \hline

 PERIODIC      & 1 :& Periodic boundary conditions (Note : must be set to 1 if any of X\_BOUNDARY, Y\_BOUNDARY, Z\_BOUNDARY or SPHERICAL\_MIRROR are set to any value other than 0) \\
               & 0 :& No periodic boundary conditions \\ \hline

 X\_BOUNDARY   & PERIODIC :& Periodic box in x-dimension  \\
               & WALL     :& Walls in LHS and RHS directions of x-dimension \\
               & 0        :& No periodicity in x-dimension \\ \hline

 Y\_BOUNDARY   & PERIODIC :& Periodic box in y-dimension \\
               & WALL     :& Walls in LHS and RHS directions of y-dimension \\
               & 0        :& No periodicity in y-dimension \\ \hline

 Z\_BOUNDARY   & PERIODIC :& Periodic box in z-dimension \\
               & WALL     :& Walls in LHS and RHS directions of z-dimension \\
               & 0        :& No periodicity in z-dimension \\ \hline

 SPHERICAL\_WALL & 1 :& Spherical mirror to reflect particles that exceed some give radial distance \\
                   & 0 :& No spherical mirror \\ \hline

 CYLINDRICAL\_WALL & 1 :& Cylindrical mirror to reflect particles that exceed some given distance about z-axis \\
                   & 0 :& No spherical mirror \\ \hline

 GHOST\_PARTICLES       & 1 :& Use ghost particles for periodic boundaries (experimental; advise not to use for now) \\
                        & 0 :& No ghost particles; use relative position periodic wrapping \\ \hline

 SPH\_SIMULATION        & 1 :& Perform SPH simulation \\
                        & 0 :& No SPH simulation \\ \hline

 NBODY\_SPH\_SIMULATION & 1 :& Perform hybrid N-body/SPH simulation \\
                        & 0 :& No hybrid simulation \\ \hline

 NBODY\_SIMULATION      & 1 :& Perform N-body simulation \\
                        & 0 :& No N-body simulation \\ \hline

 SPH           & STANDARD       :& Use traditional SPH formulation (Monaghan 1992) \\
               & GRAD\_H\_SPH   :& Use 'grad-h' SPH formulation (Springel \& Hernquist 2002; Price \& Monaghan 2004) \\ 
               & RTSPH          :& Use Ritchie \& Thomas (2001) SPH formulation \\ \hline

 SPH\_INTEGRATION & RK2   :& 2nd order Runge-Kutta integration scheme \\
                  & LFKDK :& 2nd order Leapfrog kick-drift-kick scheme \\
                  & LFDKD :& 2nd order Leapfrog drift-kick-drift scheme \\ \hline

 KERNEL        & M4      :& M4 kernel (Monaghan \& Lattanzio 1985) \\
               & M4TC    :& M4 kernel with modifed 1st derivative (Thomas \& Couchman 1992) \\ 
               & QUINTIC :& Quitic kernel (Morris 1996) \\
               & QUINTICTC :& Quintic kernel with modified 1st derivative (c.f. Thomas \& Couchman 1992) \\
               & GAUSSIAN\_3H :& Gaussian kernel truncated at $3\,h$ \\ \hline

 HFIND         & NUMBER   :& Determine $h$ by number of neighbours \\
               & MASS     :& Determine $h$ by total mass of neighbours \\ 
               & H\_RHO   :& Determine $h$ by iterating h-rho relation (as in `grad-h' SPH') \\
               & CONSTANT :& Use contant smoothing length \\ \hline

 MINIMUM\_H    & 1 :& Set a minimum smoothing length \\
               & 0 :& Allow any smoothing length \\ \hline

 HYDRO         & 1 :& Hydro forces switched on \\
               & 0 :& No hydro forces \\ \hline

 ENERGY\_EQN   & 1 :& Activate energy equation \\
               & 0 :& Do not include energy equation in compliation \\ \hline

 ENTROPY\_EQN  & 1 :& Activate entropy equation \\
               & 0 :& Do not include entropy equation in compliation \\ \hline

 ARTIFICIAL\_VISCOSITY  & MON97 :& Monaghan (1997) artificial viscosity \\
               & AB    :& Standard $\alpha$-$\beta$ viscosity (Monaghan \& Gingold 1983)\\
               & 0     :& No artificial viscosity \\ \hline

 VISC\_TD      & 1  :& Use time-dependent value of $\alpha$ (Morris \& Monaghan 1997)\\
               & 0  :& Constant value for $\alpha$ \\ \hline

 BALSARA       & 1  :& Use Balsara switch (Balsara 1995) \\
               & 0  :& No Balsara switch \\ \hline

 PATTERN\_REC  & 1 :& Use Keplarian pattern-matching (Cartwright \& Stamatellos 2010) \\
               & 0 :& Do not use pattern matching \\ \hline

 ARTIFICIAL\_CONDUCTIVITY  & 0         :& No artificial conductivity \\
                           & PRICE2008 :& Artificial conductivity with constant $\alpha_{_{\rm COND}}$ (Price 2008)\\ 
                           & WADSLEY2008 :& Wadsley et al. (2008) conductivity\\ \hline

 EXTERNAL\_PRESSURE & 0 :& No external pressure \\
                    & 1 :& Simple external pressure formulation \\ \hline

 RAD\_WS       & 1 :& Activate radiative cooling scheme (Stamatellos et al. 2007) \\
               & 0 :& Do not include radiative cooling in compilation \\ \hline

 FLUX\_LIMITED\_DIFFUSION & 1 :& Switch on flux-limited diffusion for hybrid radiation scheme (Forgan et al. 2009).  Only activated when RAD\_WS = 1. \\
                          & 0 :& No flux-limited diffusion \\ \hline

 SINK\_POTENTIAL\_WS      & 1 :& Use gravitational potential from sink in radiative cooling calculations \\
                          & 0 :& Ignore gravitational potential from sinks for cooling \\ \hline

 AMBIENT\_HEATING\_WS     & 1 :& External ambient heating source (e.g. CMB)\\ 
                          & 0 :& No ambient heating \\ \hline

 SINK\_HEATING\_WS        & STAR\_HEATING :& \\ 
                          & STAR\_SIMPLE\_HEATING :& \\
                          & HDISC\_HEATING :& \\
                          & 0 :& \\ \hline

 COOLING\_HEATING    & 0 :& No cooling or heating terms added \\
                     & EXPLICIT :& Explicit cooling/heating terms added to energy equation (Experimental) \\ \hline

 IONIZING\_RADIATION & 0 :& No ionizing sources \\
                     & SINGLE\_STATIC\_SOURCE :& Single static source of ionizing radiation (Bisbas et al. 2009) \\
                     & MULTIPLE\_SINK\_SOURCES :& Sink particles act as sources of ionizing radiaiton (experimental) \\ \hline

 STELLAR\_WIND       & 0 :& No wind sources \\
                     & SINGLE\_STATIC\_SOURCE :& Single static source of wind \\ \hline 

% STELLAR\_LUMINOSITY & 0: & No luminosity feedback from stars \\
%                     & 1: & Luminosity feedback from stars using HEALPix (experimental) \\ \hline

 EXTERNAL\_FORCE & 0       :& No external forces \\
                 & PLUMMER :& Plummer sphere potential \\
                 & UDS     :& Uniform density sphere potential \\
                 & NFW1996 :& Navarro, Frenk \& White (1996) potential \\ \hline

 SELF\_GRAVITY & 0  :& No gravitational forces computed \\
	       & KS :& Kernel-softened gravity for 2-body forces \\
	       & NBODY :& Newton's gravitational law for all 2-body forces 
\\ \hline

 MEANH\_GRAVITY & 1 :& Use mean-h gravity (cf. Price \& Monaghan 2007) \\
                & 0 :& Use default gravity \\ \hline

 EWALD         & 1 :& Ewald periodic gravity switched on \\
               & 0 :& No Ewald corrections \\ \hline

 SINKS         & 0  :& No sinks \\
               & SIMPLE :& Simple (i.e. only gravitating) sinks (Bate, Bonnell \& Price 1995)\\ 
               & NO\_ACC :& Simple sinks with no accretion \\
               & SMOOTH\_ACC :& Sinks with smooth accretion (Hubber et al. 2013) \\ \hline

 SINK\_RADIUS  & FIXED\_ABSOLUTE :& Absolute value (in AU in params.dat file; same for all sinks) \\ 
               & FIXED\_HMULT    :& Multiple of mean h at sink density (same for all sinks) \\
               & HMULT           :& Multiple of h at sink density (individual values for sinks) \\ \hline

 SINK\_REMOVE\_ANGMOM & 1 :& Deposit sink ang. mom. on nearby particles \\
                      & 0 :& Sink particle retain ang. mom. of accreted particles \\ \hline

 SINK\_GRAVITY\_ONLY & 0 :& Consider all physical sources of gravity \\ 
	             & KS :& Sinks only source of gravity using Kernel-softened gravity for 2-body forces  \\
	             & NBODY :& Sinks only source of gravity using Newton's gravitational law for all 2-body forces \\ \hline

 NBODY\_INTEGRATION  & HERMITE4 :& 4th-order Hermite integration scheme (Makino \& Aarseth 1992) \\
                     & LFKDK :& 2nd-order Leapfrog KDK integration scheme \\ \hline


 BINARY\_STATS & 1 :& Calculate binary statistics and output to file \\
               & 0 :& No binary calculations \\ \hline

 TREE          & 0      :& No tree (all quantities calculated by direct summation) \\
	       & BH     :& Use Barnes-Hut tree (octal-spatial; Barnes \& Hut 1985) \\ \hline

 MULTIPOLE     & 0  :& No higher-order multipole terms \\
               & QUADRUPOLE :& Include quadrupole moment terms in gravity calculations \\
               & OCTUPOLE :& Include both octupole and quadrupole moment terms \\ \hline

 MAC           & GEOMETRIC :& Use standard Barnes-Hut geometric opening angle criterion (Barnes \& Hut 1985) \\
               & GADGET    :& Use Gadget-style higher-order moment criterion (Springel et al. 2002) \\
               & GADGET2   :& Use Gadget 2.0 moment (Springel 2005) \\
               & EIGEN     :& Use Eigenvalues of Q tensor to compute appropriate MAC (Hubber et al. 2010)\\ \hline

 REORDER       & PARTICLES  :& Re-order particles in arrays according to tree-walk order  \\
               & 0   :& No re-ordering \\ \hline

 SORT          & INSERTION :& Use insertion sort for sorting lists \\
               & HEAP      :& Use heapsort for sorting lists\\ \hline

 TIMESTEP      & ADAPTIVE   :& Block timestep levels adjusted at resync \\
               & FIXED      :& Fixed block timestep levels, with maximum level set by the \var{dt\_fixed} parameter\\ 
               & RESTRICTED :& Timestep levels can only take certain values
                 (dt\_fixed parameter times integer power of 2), but are readjusted at resync \\ \hline

 CHECK\_NEIB\_TIMESTEP & 2 :& Ensure neighbours have similar timesteps \\
                       & 1 :& As option 2, but doesn't change timestep in middle of current step \\
                       & 0 :& No neighbour timestep comparison \\ \hline

 SIGNAL\_VELOCITY\_DT  & 1 :& Use signal velocity for Courant timestep \\
                       & 0 :& Use velocity divergence for Courant timestep \\ \hline

 NEIGHBOURLISTS & 1 :& Store neighbour lists in memory \\
                & 0 :& Do not store neighbour lists in memory \\ \hline

 KERNEL\_TABLES & 1 :& Tabulate kernels in arrays for quick lookup \\ 
                & 0 :& Use inline function calls for kernel functions \\ \hline

 REMOVE\_OUTLIERS & 1 :& Remove outlying particles from the simulation (Experimental) \\
                  & 0 :& No removal of outliers \\ \hline

 TURBULENT\_FORCING & 1 :& .... \\
                    & 0 :& No turbulent forcing \\ \hline

 TIMING\_CODE  & 1 :& Use custom subroutines to produce timing statistics \\
               & 0 :& No timing output \\ \hline

 TEST          & FREEFALL :& Freefall collapse test \\
               & SPIEGEL  :& Spiegel (ref??) test \\
               & BINARY   :& Orbitting binary stars test \\
               & PLUMMER  :& Plummer sphere stability test \\
               & ENTROPY  :& Entropy core test \\
               & 0        :& No test flags \\ \hline

\end{supertabular}
\end{center}
\vspace{1cm}

\newpage


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Debug flags} \label{SS:PARAMS}
The SEREN Makefile contains a number of debug flags below the main options which can be switched on or off by uncommenting them or commenting them out.  Most of the debug flags produce verbose output of each routine, and in some cases produce extra files with more important information.  The full list of debugging options with additional output is shown in the table below.\newline

\tablecaption{List of special debugging options available in SEREN}
\tablehead{\hline \bf{Variable} & \bf{Options} \\ \hline}
\tabletail{\hline}
\tablelasttail{\hline}
%\begin{figure}
\begin{center}
\begin{supertabular}{|p{6cm}|p{8cm}|}
%\hline
%\bf{Variable} & \bf{Options} \\
%\hline
IEEE\_EXCEPTION\_HANDLING   & \\
DEBUG\_DIV\_A               & \\
DEBUG\_ACCRETE              & \\
DEBUG\_ALLOCATE\_MEMORY     & \\
DEBUG\_BHTREEBUILD          & \\
DEBUG\_BHTREESTOCK          & \\
DEBUG\_BHTREEWALK           & \\
DEBUG\_BHTREEGRAVITY        & \\
DEBUG\_BINARY\_PROPERTIES   & Ouput binary properties to screen when calculated \\
DEBUG\_BINARY\_SEARCH       & \\
DEBUG\_BLOCK\_TIMESTEPS     & Outputs occcupation of timestep levels \\
DEBUG\_COPY\_PARTICLE\_DATA & \\
DEBUG\_CREATE\_SINK         & \\
DEBUG\_CREATE\_HP\_SOURCE   & \\
DEBUG\_DENSITY              & \\
DEBUG\_DIV\_V               & \\
DEBUG\_DUDTRAD              & \\
DEBUG\_ENERGY\_EQN          & \\
DEBUG\_FOLIATE              & \\
DEBUG\_FORCES               & Records individual grav, hydro, magnetic forces\\
DEBUG\_FREEFALL             & \\
DEBUG\_GATHER\_NEIB         & \\
DEBUG\_GET\_NEIB            & \\
DEBUG\_GHOST\_PARTICLES     & \\
DEBUG\_GRAD\_H\_SPH         & \\
DEBUG\_GRID\_RESULTS        & \\
DEBUG\_HEAPSORT             & \\
DEBUG\_HERMITE4             & \\
DEBUG\_H\_GATHER            & \\
DEBUG\_H\_GATHER\_DENSITY   & \\
DEBUG\_H\_GUESS             & \\
DEBUG\_HP\_IF               & \\
DEBUG\_HP\_OUTPUT           & Outputs various ionization properties to files \\
DEBUG\_HP\_SPLIT\_ACTIVE\_RAYS & \\
DEBUG\_HP\_WALK\_ALL\_RAYS  & \\
DEBUG\_HP\_WALK\_RAY        & \\
DEBUG\_INTEGRATE            & \\
DEBUG\_KERNEL               & Outputs file 'kernel.dat' \\
DEBUG\_MHD                  & \\
DEBUG\_NBODYSETUP           & \\
DEBUG\_OUTPUT\_STAR\_DATA   & \\
DEBUG\_PARAMETERS           & \\
DEBUG\_PLOT\_DATA           & Outputs regular debug files with snapshot files.
                              Files are simple column-data files where the 
                              information of each column is written to the 
                              \var{run\_id.params} file.\\
DEBUG\_RAD                  & Outputs 'run\_id.rad' file for RAD\_WS tests \\
DEBUG\_REDUCE\_TIMESTEP     & \\
DEBUG\_REMOVE\_OUTLIERS     & \\
DEBUG\_RSPH\_OUTPUT         & Outputs files in RSPH format \\
DEBUG\_SINK\_REMOVE\_ANGMOM & \\
DEBUG\_SINK\_SEARCH         & \\
DEBUG\_SINK\_TIMESTEP       & \\
DEBUG\_SKELETON             & \\
DEBUG\_SMOOTH\_ACCRETE\_PARTICLES & \\
DEBUG\_SPH\_UPDATE          & \\
DEBUG\_SWAP\_PARTICLE\_DATA & \\
DEBUG\_TIMESTEP\_SIZE       & \\
DEBUG\_TRACK\_PARTICLE      & Outputs single file ('track1.dat') which 
                              contains large amount of information (same as 
                              that ouputted by debug files including the time) 
                              of one single chosen particle (set by parameter 
                              \var{ptrack} in \var{params.dat} file) which is 
                              printed every timestep. \\
DEBUG\_TREE\_BUILD          & \\
DEBUG\_TREE\_GRAVITY        & \\
DEBUG\_TREESTOCK            & \\
DEBUG\_TREEWALK             & \\
DEBUG\_TYPES                & \\
DEBUG\_VISC\_BALSARA        & \\
DEBUG\_VISC\_PATTERN\_REC   & \\
DEBUG\_WRITE\_MPI\_TASK     & \\
\end{supertabular}
\end{center}
%\caption{List of special debugging options available in SEREN}
%\end{center}
%\end{figure}

\vspace{1cm}


\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Parameter file} \label{SS:PARAMS}
SEREN contains all simulation information in a single parameter file, called \var{params.dat}.  The information contained in the parameters file in version 1.0 is shown in the following table. \newline

\tablecaption{List of user parameters in SEREN}
\tablehead{\hline \bf{Variable} & \bf{Type} & \bf{Description} \\ \hline}
\tabletail{\hline}
\tablelasttail{\hline}
%\begin{figure}
\begin{center}
\begin{supertabular}{|p{3cm}|p{2cm}|p{8cm}|}

%\begin{center}
%\begin{tabular}{|l|l|l|}
%\hline
%\bf{Variable} & \bf{Type} & \bf{Description}  \\
%\hline
\var{run\_id}    & char(256) & Run identifier string \\
\var{run\_dir}   & char(256) & Output directory name \\
\var{in\_file}   & char(256) & Name of initial conditions file \\
\var{in\_file\_form}  & char(50) & Format of initial conditions file \\
\var{out\_file\_form} & char(50) & Format of output snapshot files \\ \hline
\var{restart}    & logical   & Is this a restart or a new run? \\ 
\var{com\_frame} & logical   & Change to centre of mass frame? \\
\var{rseed}      & int       & Random number seed \\
\var{ptrack}     & int       & i.d. of tracked particle \\ \hline
\var{sph\_endtime}   & DP  & End time of SPH simulation \\
\var{nbody\_sph\_endtime} & DP & End time of hybrid N-body/SPH simulation \\
\var{nbody\_endtime} & DP    & End time of N-body simulation \\
\var{firstsnap}  & DP        & Time of first snapshot \\
\var{snaptime}   & DP        & Snapshot time interval (in real time) \\
\var{noutputstep}& int       & Screen output interval (in integer steps) \\
\var{ntempstep}  & int       & Temporary snapshot interval (in integer steps) \\
\var{ndiagstep}  & int       & Integer time interval between diagnostic output \\
\var{nsinkstep}  & int       & Sink output time interval (in integer time) \\ 
\var{nsnapstep}  & int       & Snapshot time interval (in integer time) \\
\var{courant\_mult} & DP     & Courant timestep multiplication factor \\
\var{accel\_mult} & DP       & Acceleration timestep multiplication factor \\
\var{sink\_mult} & DP        & Sink accel. timestep multiplication factor \\
\var{nbody\_timemult} & DP   & Timestep factor for N-body simulations \\
\var{nlevels}    & int       & Number of multiple timestep levels \\
\var{dt\_fixed}  & DP        & Fixed ref. time for creating timestep levels \\ \hline
\var{runit}      & char(256) & Length scaling unit \\
\var{munit}      & char(256) & Mass scaling unit \\
\var{tunit}      & char(256) & Time scaling unit \\
\var{vunit}      & char(256) & Velocity scaling unit \\
\var{aunit}      & char(256) & Acceleration scaling unit \\
\var{rhounit}    & char(256) & Density scaling unit \\
\var{sigmaunit}  & char(256) & Column density scaling unit \\
\var{Punit}      & char(256) & Pressure scaling unit \\
\var{funit}      & char(256) & force scaling unit \\
\var{Eunit}      & char(256) & Energy scaling unit \\
\var{momunit}    & char(256) & Momentum scaling unit \\
\var{angmomunit} & char(256) & Angular momentum scaling unit \\
\var{angvelunit} & char(256) & Angular velocity scaling unit \\
\var{dmdtunit}   & char(256) & Accretion rate scaling unit \\
\var{Lunit}      & char(256) & Luminosity scaling unit \\
\var{kappaunit}  & char(256) & Opacity scaling unit \\
\var{Bunit}      & char(256) & Magnetic field (B-field) scaling unit \\
\var{Qunit}      & char(256) & Electric charge unit \\
\var{Junit}      & char(256) & Current density unit \\
\var{uunit}      & char(256) & Specific internal energy unit \\
\var{dudtunit}   & char(256) & Rate of change of specific internal energy unit \\
\var{tempunit}   & char(256) & Temperature unit \\
\var{rscale}     & DP        & Length scaling factor \\
\var{mscale}     & DP        & Mass scaling factor \\ \hline
\var{periodic\_min(1)} & PR & Size of periodic box in x-dimension \\
\var{periodic\_max(1)} & PR & Size of periodic box in x-dimension \\
\var{periodic\_min(2)} & PR & Size of periodic box in y-dimension \\
\var{periodic\_max(2)} & PR & Size of periodic box in y-dimension \\
\var{periodic\_min(3)} & PR & Size of periodic box in z-dimension \\
\var{periodic\_max(3)} & PR & Size of periodic box in z-dimension \\ 
\var{rspheremax}       & PR & Radius of spherical wall \\ 
\var{psphere}    & int      & Mirror origin id (0 : co-ordinates origin; p : SPH particle; -s : sink particle) \\ \hline
%\end{tabular}
%\end{center}
%
%\begin{center}
%\begin{tabular}{|l|l|l|}
%\hline
%\bf{Variable} & \bf{Type} & \bf{Description} \\
%\hline
\var{pp\_gather} & int      & Neighbours required to determine $h$ \\
\var{hmin}       & PR       & Minimum allowed smoothing length \\
\var{h\_fac}     & PR       & grad-h density-h iteration factor \\ \hline
\var{boundaryeos}& char(256)& Boundary particle equation-of-state \\
\var{icmeos}     & char(256)& ICM particle equation-of-state \\
\var{gaseos}     & char(256)& Gas particle equation-of-state \\
\var{isotemp}    & PR       & Temperature for isothermal, barotropic EOSs (K) \\
\var{rhobary}    & PR       & Adiabatic density for barotropic density (cgs units) \\
\var{gamma}      & PR       & Ratio of specific heats \\
\var{mu\_bar}    & PR       & Mean gas particle mass (in a.m.u.) \\
\var{Kpoly}      & PR       & Polytropic constant \\ 
\var{Pext}       & PR       & External pressure \\ \hline
\var{cooling\_law} & char(256) & Cooling law used \\ \hline
\var{alpha}      & PR       & $\alpha$-viscosity value \\
\var{beta}       & PR       & $\beta$-viscosity value \\
\var{alpha\_min} & PR       & Minimum value of $\alpha$ \\ \hline
\var{abserror}   & PR       & Absolute error fraction in GADGET MAC \\ 
\var{thetamaxsqd}& PR       & Maximum opening angle squared (Geometric MAC) \\
\var{nbuildstep} & int      & Frequency of DRAGON tree builds (in integer time units) \\ \hline
\var{rhosink}    & PR       & Sink formation density (cgs units) \\
\var{sinkrad}    & PR       & Sink radius (in units of $h$ or in AU depending on options) \\
\var{nsearchstep} & int     & No. of integer timesteps between sink search \\
\var{rho\_search} & logical & Calculate density for selecting sink candidates \\
\var{potmin\_search} & logical & Only consider particles at potential minimum \\
\var{hill\_sphere\_search} & logical & Hill spheres of sinks must not overlap \\
\var{energy\_search}  & logical & Only create sinks from bound objects \\
\var{thermal\_search}  & logical & Only create sinks from thermally bound objects \\
\var{div\_v\_search}  & logical & Only create sinks from converging objects \\
\var{div\_a\_search}  & logical & Do not create sinks if particles are accelerating apart \\
\var{timescale\_search} & logical & Compare timescales for sink formation \\ \hline
\var{energy\_accrete} & logical & Only accrete bound particles \\
\var{alpha\_ss}       & PR       & Sunyaev-Shakura viscosity parameter \\
\var{smooth\_accrete\_frac} & PR & Fraction of mass for instant accretion \\
\var{smooth\_accrete\_dt}   & PR & Timestep fraction for instant accretion \\
\var{f\_accretion}    & PR      & Fraction of accretion energy radiated as luminosity \\
\var{feedback\_tdelay} & PR     & Time delay between sink formation and feedback\\
\var{feedback\_minmass} & PR    & \\ \hline
\var{rho\_remove}    & logical  & Remove particles below density threshold? \\
\var{energy\_remove} & logical  & Remove unbound particles from system? \\
\var{rad\_remove}    & logical  & Remove distant particles? \\
\var{rholost}        & PR       & Density removal threshold \\
\var{rad\_lost}      & PR       & Distance removal threshold \\ \hline
\var{npec}           & int      & No. of Predict-correct-evaluate iterations \\
\var{nbody\_frac}    & PR       & Fraction of mass accreted before switching to N-body \\ \hline
\var{ptemp0}         & PR       & Disc temperature at $r = 1\,{\rm AU}$ from star (K) \\
\var{temp\_inf}      & PR       & Disc temperature at infinity (K) \\
\var{ptemp\_r0}      & PR       & Temperature softening radius ($\ll 1\,{\rm AU}$) \\
\var{ptemp\_q}       & PR       & Temperature power law index \\
\var{fcolumn}        & PR       & Column polytrope factor \\ \hline
\var{nionallstep}    & int      & Integer steps inbetween HEALPix walk \\
\var{f1}             & PR       & Integration step accuracy variable \\
\var{f2}             & PR       & HEALPix resolution factor \\
\var{f3}             & PR       & Temperature smoothing parameter \\
\var{f4}             & PR       & Density interpolation parameter \\
\var{Tneut}          & PR       & Temperarure of neutral gas \\
\var{Tion}           & PR       & Temperature of ionized gas \\
\var{Xfrac}          & PR       & Fraction of hydrogen \\
\var{mu\_ion}        & PR       & Mean gas particle mass for ionisied gas \\
\var{a\_star}        & PR       & Recombination coefficient \\
\var{N\_LyC}         & PR       & No. of ionizing photons per second \\
\var{rstatic}        & PR(1:3)  & Location of single static ionizing source \\
\var{lmax\_hp}       & PR       & Maximum allowed number of HEALPix levels \\
\var{M\_loss}        & PR       & Wind mass loss rate from source \\
\var{v\_wind}        & PR       & Wind velocity from star \\ \hline
\var{comp\_frac}     & PR       & .. \\
\var{turb\_T}        & PR       & .. \\
\var{turb\_Ndt}      & PR       & .. \\
\var{turb\_min}      & PR(1:3)  & .. \\
\var{turb\_max}      & PR(1:3)  & .. \\ \hline
\end{supertabular}
\end{center}
\vspace{1cm}


\newpage



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Generating initial conditions} \label{SS:ICS}
SEREN contains a large number of small programs which can be used to generate initial conditions to run simulations.  These programs are contained in the sub-directory \var{/seren/ic} and can be compiled.  To compile any initial conditions program of some name \var{ic\_name}, simply type \newline 

\var{make ic\_name} \newline

\noindent Some of the initial conditions programs require their own separate parameters file, a template of which can be found in the \var{seren/datafiles} sub-directory.  These parameters files must be copied into the main seren run directory in order to be accessed by the initial conditions program.  To run the initial conditions program, type \newline

\var{./ic\_name}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{ic\_BB}
\var{ic\_BB} sets-up the Boss-Bodenheimer test (Boss \& Bodenheimer 1979), i.e. a uniform density sphere with an azimuthal density perturbation in solid-body rotation.  Program reads in a unifrom density sphere of unit radius (centred at the origin), scales to the required density and radius, and then adds the azimuthal perturbation and a solid-body velocity field.  The original Boss-Bodenheimer test considered simply an isothermal EOS, but many subsequent studies have used barotropic and other EOSs.  Parameters read in from file \var{BBparams.dat}. \newline

\noindent Required Makefile options :
\begin{itemize}
\item NDIM = 3
\item SPH = STANDARD/GRAD\_H\_SPH
\item HYDRO = 1
\item GRAVITY = KS
\item DIMENSIONLESS = 0
\end{itemize}
\vspace{0.1cm}

%\tablecaption{List of parameters for running ic\_BB in BBparams.dat}
\tablehead{\hline \bf{Variable} & \bf{Type} & \bf{Description} \\ \hline}
\tabletail{\hline}
\tablelasttail{\hline}
\begin{center}
\begin{supertabular}{|p{3cm}|p{2cm}|p{8cm}|}
in\_file         & char(256) & Input filename (file containing uniform density sphere of unit radius) \\
in\_file\_form   & char(256) & Input file format \\
out\_file        & char(256) & Output filename \\
out\_file\_form  & char(256) & Output file format \\
mass             & PR       & Mass of cloud \\
munit            & char(256) & Mass unit \\
rcloud           & PR       & Radius of cloud \\
runit            & char(256) & Length unit \\
temp\_cloud      & PR       & Temperature of cloud \\
angvel           & PR       & Angular velocity of cloud \\
angvelunit       & char(256) & Angular velocity unit \\
mpert            & integer  & Order of azimuthal perturbation (usually mpert=2) \\
amp              & PR       & Amplitude of density perturbation (usually 0.1 or 0.5)\\
\end{supertabular}
\end{center}

\newpage


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{ic\_binary}
\var{ic\_binary} sets up a binary system from two polytropes (or other self-gravitating structures) read in from files.  Parameters read in from file \var{binaryparams.dat}. \newline

\noindent Required Makefile options :
\begin{itemize}
\item NDIM = 3
\item HYDRO = 1
\item DIMENSIONLESS = 1
\end{itemize}
\vspace{0.1cm}

%\tablecaption{List of parameters for running ic\_BB in BBparams.dat}
\tablehead{\hline \bf{Variable} & \bf{Type} & \bf{Description} \\ \hline}
\tabletail{\hline}
\tablelasttail{\hline}
\begin{center}
\begin{supertabular}{|p{3cm}|p{2cm}|p{8cm}|}
in\_file1        & char(256) & Input filename 1 \\
in\_file2        & char(256) & Input filename 2 \\
in\_file\_form1  & char(256) & Input file 1 format \\
in\_file\_form2  & char(256) & Input file 2 format \\
out\_file        & char(256) & Output filename \\
out\_file\_form  & char(256) & Output file format \\
abin             & PR        & Separation (semi-major axis) of binary \\
ecc		 & PR        & Eccentricity of binary \\
corot            & logical   & Are stars co-rotating with binary orbit? \\
\end{supertabular}
\end{center}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{ic\_core}
\var{ic\_core} creates a spherically symmetric density distribution for any given density function (as a function of radial distance).  Currently only contains the distribution for a plummer-like density profile and a radial power-law density function.  Requires the params file \var{core.dat}. \newline

\noindent Required Makefile options :
\begin{itemize}
\item NDIM = 3
\item HYDRO = 1
\item SELF\_GRAVITY = KS
\item DIMENSIONLESS = 0
\end{itemize}

\newpage


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{ic\_jeans}
\var{ic\_jeans} sets-up the Jeans instability test (Hubber et al. 2006) which tests the ability of SEREN to resolve the Jeans gravitational instability.  Program reads in a relaxed unit cube (with the cube placed in positive octant) and stretches the particle distribution to produce a 1-D sinusoidal density perurbation.  Currently reads in parameters from the command line rather than via a separate parameters file. \newline

\noindent Required Makefile options :
\begin{itemize}
\item NDIM = 3
\item PERIODIC = 1
\item PERIODIC\_X = 1
\item PERIODIC\_Y = 1
\item PERIODIC\_Z = 1
\item SPH = STANDARD/GRAD\_H\_SPH
\item HYDRO = 1
\item GRAVITY = KS
\item EWALD = 1
\item DIMENSIONLESS = 1
\end{itemize}

\vspace{0.1cm}

\begin{center}
\begin{supertabular}{|p{3cm}|p{2cm}|p{8cm}|}
in\_file         & char(256) & Input filename (File containing unit-uniform density sphere)\\
in\_file\_form   & char(256) & Input file format \\
out\_file        & char(256) & Output filename \\
out\_file\_form  & char(256) & Output file format \\
npert            & int       & No. of wavelengths \\
amp              & PR        & Amplitude of sinuosoidal perturbation \\
\end{supertabular}
\end{center}

\newpage



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{ic\_KH}
\var{ic\_KH} creates the initial conditions for the Kelvin-Helmholtz instability test.  Requires \var{KHparams.dat} file.  


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{ic\_lattice\_cube}
\var{ic\_lattice\_cube} creates a cubic-lattice distribution of particles with side-length \var{length} and \var{ppd} particles in each dimension.  Therefore the total number of particles in the lattice is $\var{ppd}^{\rm NDIM}$.  In 1-D, the program produces a uniformly-spaced line of particles, in 2-D a square-grid of particles, and in 3-D a cubic lattice.  The lattice extends from $0$ to $\var{length}$ in each dimension.  Parameters are currently read in from the command-line.  \newline

\noindent Required Makefile options :
\begin{itemize}
\item NDIM = 1/2/3
\item DIMENSIONLESS = 1
\end{itemize}

\vspace{0.1cm}

\begin{center}
\begin{supertabular}{|p{3cm}|p{2cm}|p{8cm}|}
ppd              & integer   & Particles per dimension in lattice (Must be a positive integer)\\
length           & PR        & Total length of lattice edge (For a unit cube, length = 1)\\
out\_file        & char(256) & Output filename \\
out\_file\_form  & char(256) & Output file format \\
\end{supertabular}
\end{center}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{ic\_NTSI}
\var{ic\_NTSI} generates the initial conditions for the non-linear thin-shell instability (NTSI) test.  Requires the parameters file \var{NTSIparams.dat}.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{ic\_plummer}
\var{ic\_plummer} generates the a Plummer sphere, either with stars, gas, cdm particles, or a mixture of the three.  Requires the parameters file \var{plummer.dat}.

\newpage



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{ic\_polytrope}
Creates a finite polytrope/infinite polytrope with surrounding medium from a uniform-density sphere of unit radius centred at the origin.  For an isothermal polytrope (e.g. a Bonner-Ebert sphere), the inputted sphere is divided into 4 regions; the polytrope (self-gravitating gas), the gas envelope (self-gravitating gas), the surrounding inter-cloud medium (non-self gravitating gas) and a static outer-wall (boundary particles).  The outer-three regions are optional depending on the parameters selected in \var{polytrope.dat}. \newline

\noindent Required Makefile options :
\begin{itemize}
\item NDIM = 3
\item THERMAL = ISOTHERMAL/POLYTROPIC/BAROTROPIC
\item HYDRO = 1
\item SELF\_GRAVITY = KS
\item DIMENSIONLESS = 0
\end{itemize}

\vspace{0.1cm}

\begin{center}
\begin{supertabular}{|p{3cm}|p{2cm}|p{8cm}|}
in\_file         & char(256) & Input filename (File containing unit-uniform density sphere)\\
in\_file\_form   & char(256) & Input file format \\
out\_file        & char(256) & Output filename \\
out\_file\_form  & char(256) & Output file format \\
isocloud         & logical   & Flag true if isothermal polytrope (if true, gas\_eos must equal isothermal) \\
etapoly          & PR        & Polytropic index \\
xi\_bound        & PR        & Dimensionless cloud boundary (6.35 for a mariginally stable Bonner-Ebert sphere) \\
mpoly            & PR        & Mass of cloud \\
munit            & char(256)  & Mass unit (e.g. \var{m\_sun})\\
rho0             & PR        & Central density of cloud (Only if \var{mflag = rho0}) \\
rhounit          & char(256)  & Density unit \\
mflag            & char(20)  & Set the total mass (mass) or central density (rho0) of the polytrope \\
Kpoly            & PR        & Polytropic constant, or $a_0^2$ for isothermal polytrope \\
vunit            & char(256)  & Velocity unit (unit of isothermal speed of gas if isothermal polytrope is selected)\\
menvelope        & PR        & Mass of gas envelope around polytrope (distributed uniformly around the polytrope with the same density and pressure as the polytrope at its surface)\\
micm             & PR        & Mass of IcM envelope which surrounds gas (distributed uniformly around the polytrope/gas envelope with the same density and pressure as the polytrope at its surface)\\
hboundary        & PR        & Size of static boundary zone (in units of the mean smoothing length; should be 3 or 4 to ensure no edge effects occur for interior gas particles) \\
\end{supertabular}
\end{center}

\newpage


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{ic\_radtest}
\var{ic\_radtest} creates the initial conditions to perform the Masunaga-Inutsuka test (Masunaga \& Inutsuka ????) using the radiative cooling method of Stamatellos et al. (2007; RAD\_WS option).


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{ic\_random\_cube}
\var{ic\_random\_cube} creates a line, sheet or cube (depending on the dimensionality) of randomlly-placed particles.  Distributes particles between $0$ and \var{length} in each dimension. Parameters are currently read in from the command-line rather than a separate parameters file. \newline

\noindent Required Makefile options :
\begin{itemize}
\item NDIM = 1/2/3
\item DIMENSIONLESS = 1
\end{itemize}

\vspace{0.1cm}

\begin{center}
\begin{supertabular}{|p{3cm}|p{2cm}|p{8cm}|}
ptot             & int       & Total number of particles \\
length           & PR        & Total length of lattice edge \\
out\_file        & char(256) & Output filename \\
out\_file\_form  & char(256) & Output file format \\
\end{supertabular}
\end{center}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{ic\_replicate\_cubes}
Loads in a unit cube (from $0$ to $1$ in each dimension) and creates \var{nrepeat} periodic replicas in each dimension.  The larger cube is then scaled to a unit cube itself.  Used to create large-relaxed uniform density fields from smaller files.  Parameters are read in from the command-line rather than a separate parameters file. \newline

\noindent Required Makefile options :
\begin{itemize}
\item NDIM = 1/2/3
\item DIMENSIONLESS = 1
\end{itemize}

\vspace{0.1cm}

\begin{center}
\begin{supertabular}{|p{3cm}|p{2cm}|p{8cm}|}
in\_file         & char(256) & Input filename (File containing unit cube) \\
in\_file\_form   & char(256) & Input file format \\
nrepeat          & int       & No. of replicas in each dimension 
                               (must be a positive integer) \\
out\_file        & char(256) & Output filename \\
out\_file\_form  & char(256) & Output file format \\
\end{supertabular}
\end{center}

\newpage



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{ic\_RT}
Generates initial conditions for Rayleigh-Taylor instability test.  Prepares two layers of gas with different densities in hydrostatuc balance on top of each other with a sinusoidal density perturbation to seed the instability.  A cubic grid of particles is generated rather than reading in a file.  Parameters are read in from the file \var{RTparams.dat}. \newline

\noindent Required Makefile options :
\begin{itemize}
\item NDIM = 2
\item PERIODIC = 1
\item PERIODIC\_X = 1
\item PERIODIC\_Y = 1
\item ENERGY\_EQN = 1
\item HYDRO = 1
\item SELF\_GRAVITY = 0
\item DIMENSIONLESS = 1
\end{itemize}


\begin{center}
\begin{supertabular}{|p{3cm}|p{2cm}|p{8cm}|}
out\_file         & char(256) & Output filename \\
out\_file\_form   & char(256) & Output file format \\
pertmode          & char(20)  & Perturbation mode (1=velocity, 2=boundary) \\
ppd1,ppd2         & int       & Particles per dimension \\
nlayers1,nlayers2 & int       & No. of layers of particles (in y-direction) \\
rho1,rho2         & PR        & Densities \\
Press1            & PR        & Pressure \\
acc\_grav         & PR        & External y-gravitational acceleration \\      
gamma             & PR        & Ratio of specific heats \\
xsize             & PR        & x.. \\
amp               & PR        & Amplitude of y-velocity perturbation \\
lambda            & PR        & Wavelength of perturbation \\
pp\_gather        & PR        & Required no. of SPH neighbours \\
hmin              & PR        & Minimum smoothing length \\
h\_fac            & PR        & 'grad-h' SPH factor \\
\end{supertabular}
\end{center}

\newpage


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{ic\_sedov}
Creates initial conditions for Sedov blast-wave test from inputted unit-uniform density sphere.  Requires inputting a unit-sphere.  A 'point-explosion' is added by giving the central particle and its neighbours a total energy of unity (weighted by the kernel from the centre, while the rest of the particles equally share an energy of total $10^{-6}$.  Parameters are read in from the file \var{sedovparams.dat}. \newline

\noindent Required Makefile options :
\begin{itemize}
\item NDIM = 3
\item PERIODIC = 0
\item PERIODIC\_X = 0
\item PERIODIC\_Y = 0
\item PERIODIC\_Z = 0
\item HYDRO = 1
\item ENERGY\_EQN = 1
\item SELF\_GRAVITY = 0
\item DIMENSIONLESS = 1
\end{itemize}

\vspace{0.1cm}

\begin{center}
\begin{supertabular}{|p{3cm}|p{2cm}|p{8cm}|}
in\_file         & char(256) & Input filename (File contains unit sphere)\\
in\_file\_form   & char(256) & Input file format \\
out\_file        & char(256) & Output filename \\
out\_file\_form  & char(256) & Output file format \\
rho0             & PR        & Density of sphere \\
radius           & char(20)  & Radius of sphere after rescaling \\
\end{supertabular}
\end{center}

\newpage


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{ic\_shocktube}
Generates initial conditions for general 2-part shocktube tests (e.g. Sod 1978). Reads in two relaxed cubic density distribution, creates periodic replicas in the x-direction to elongate the shocktube and sets particle properties to create the desired test problem.  Parameters are read in from the file \var{sodparams.dat}. \newline

\noindent Required Makefile options :
\begin{itemize}
\item NDIM = 1/2/3
\item PERIODIC = 1
\item PERIODIC\_X = 1
\item PERIODIC\_Y = 1
\item PERIODIC\_Z = 1
\item HYDRO = 1
\item ARTIFICIAL\_VISCOSITY = AB/MON97
\item SELF\_GRAVITY = 0
\item DIMENSIONLESS = 1
\end{itemize}

\vspace{0.1cm}

\begin{center}
\begin{supertabular}{|p{3cm}|p{2cm}|p{8cm}|}
out\_file        & char(256) & Output filename \\
out\_file\_form  & char(256) & Output file format \\
file1            & char(256) & Input filename \\
file1\_form      & char(256) & Input file format \\
file2            & char(256) & Input filename \\
file2\_form      & char(256) & Input file format \\
p1, p2           & int, int  & No. of particles in file 1, 2 \\
n1, n2           & int, int  & No. of replicas for LHS/RHS \\
rho1, rho2       & PR, PR    & Density of LHS/RHS layers \\
Press1, Press2   & PR, PR    & Pressure for LHS/RHS \\
x1, x2           & PR, PR    & x \\
y1, y2           & PR, PR    & y \\
z1, z2           & PR, PR    & z \\
v1(1), v2(1)     & PR, PR    & vx \\
v1(2), v2(2)     & PR, PR    & vy \\
v1(3), v2(3)     & PR, PR    & vz \\
B1(1), B2(1)     & PR, PR    & Bx \\
B1(2), B2(2)     & PR, PR    & By \\
B1(3), B2(3)     & PR, PR    & Bz \\
\end{supertabular}
\end{center}

\newpage


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{ic\_sphere}
Creates a spherical distribution of particles of unit radius and centred on the origin containing an exact number of particles.  First, loads in a unit cube and then iterates to find the radius that contains the correct number of particles.  Finally the spherical cut is rescaled and placed at the origin.  Will fail to find the required number of particles if the inputted unit cube has too few particles.  Sphere parameters are read in from the file \var{sphereparams.dat}. \newline

\noindent Required Makefile options :
\begin{itemize}
\item NDIM = 3
\item PERIODIC = 0
\item PERIODIC\_X = 0
\item PERIODIC\_Y = 0
\item PERIODIC\_Z = 0
\item DIMENSIONLESS = 1
\end{itemize}

\vspace{0.1cm}

\begin{center}
\begin{supertabular}{|p{3cm}|p{2cm}|p{8cm}|}
in\_file         & char(256) & Input filename \\
in\_file\_form   & char(256) & Input file format \\
out\_file        & char(256) & Output filename \\
out\_file\_form  & char(256) & Output file format \\
rcloud           & PR        & Required radius of sphere \\
nwant            & int       & Required number of particles in sphere \\
\end{supertabular}
\end{center}

\newpage


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{ic\_vel\_pert.F90}
Adds a variety of perturbations to any inputted (spherical) density distribution.  Requires parameters file \var{velpert.dat}. \newline

\noindent Required Makefile options :
\begin{itemize}
\item NDIM = 3
\item DIMENSIONLESS = 0
\end{itemize}

\vspace{0.1cm}

\begin{center}
\begin{supertabular}{|p{3cm}|p{2cm}|p{8cm}|}
in\_file         & char(256) & Input filename \\
in\_file\_form   & char(256) & Input file format \\
out\_file        & char(256) & Output filename \\
out\_file\_form  & char(256) & Output file format \\
densmode         & char(20)  & Mode of density perturbation (not used yet) \\
amp              & PR        & Amplitude of azimuthal perturbation (not used yet) \\
mpert            & integer   & Azimuthal perturbation mode (not used yet) \\
fenhance         & PR        & Density enhancement factor (increase all particle masses by \var{fenhance}; used to make stable polytropes unstable)\\
vpower           & PR        & Turbulent velocity power spectrum index\\
eturb            & PR        & Ratio of turbulent to gravitational energy \\
ngrid            & integer   & No. of grid points for vel field 
                              (determines resolution of velocity field; 
                               must be a multiple of 2)  \\
iseed1           & integer   & Random No. seed 1 \\
iseed2           & integer   & Random No. seed 2 \\
velradmode       & char(20)  & Radial velocity mode (energy, dvdr or none) \\
dvdr             & PR        & Radial velocity gradient \\
erad             & PR        & Ratio of radial kinetic to gravitational energy \\
velrotmode       & char(20)  & Rotational mode (energy, angmom, angvel or none)\\
angmom           & PR        & Total angular momentum (if velrotmode = angmom) \\
angmomunit       & char(256)  & angular momentum unit \\
angpower         & PR        & Angular velocity power law 
                               (angular velocity is a function of axial 
                               distance, $\omega \propto r^{\var angpower}$)\\
angvel           & PR        & Angular velocity \\
angvelunit       & char(256)  & Angular velocity unit \\
erot             & PR        & Ratio of rotational kinetic energy to gravitational energy \\
\end{supertabular}
\end{center}



\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Running the SEREN bash test script}
SEREN contains a bash script designed to run batches of tests of SEREN for development and debugging purposes.  The script, and all related files for running the tests, is located in the \var{/seren/testsuite} sub-directory.  In the \var{testsuite} directory, there is the \var{test-seren.sh} bash script and further sub-directories which contain files used by \var{test-seren.sh} when performing batch tests. 

A test is launched from the command line as in the following example : \newline

\var{./test-seren.sh -gfortran -openmp -debug1 -test POLYRAD1-AB} \newline

The current list of command line options for the script are ({\bf TBD}) : 

The list of tests currently set-up for use with the test script are ({\bf TBD}) : 
\newline

\tablecaption{List of automated tests in SEREN}
\tablehead{\hline \bf{Test name} & \bf{Description} \\ \hline}
\tabletail{\hline}
\tablelasttail{\hline}
%\begin{figure}
\begin{center}
\begin{supertabular}{|p{3cm}|p{10cm}|}
ADSOD-3D & Classic SOD test of two initially static columns of gas in contact 
           which then interact  forming a shock. Gas is non-radiative so 
           the energy equation is solved and no energy  escapes the system
           (i.e. it is adiabatic). \\ \hline

BURRAU1  & Burrau 3-body problem (Burrau 19??); also known as the Pythagorean 
           problem.  Three stars with masses $3$, $4$ and $5$ placed on the 
           corners of a right-angled triangle all with zero-velocity and 
           allowed to evolve until the system dissolves into a single star 
           and a binary star. \\ \hline

COL-3D   & Two columns of uniform density gas collide supersonically to produce
           a dense shocked layer. \\ \hline

EIGEN1   & Gravitational force accuracy using eigenvalue MAC \\ \hline

FIGURE8  & Figure-8 3-body test for N-body integrator (????). \\ \hline

FREEFALL1 & Free-fall collapse test. \\ \hline

GEO1     & Gravitational force accuracy using geometric MAC \\ \hline

ISOFREEFALL1 & Isothermal free-fall collapse test \\ \hline

KH-2D    & 2D Kelvin-Helmholtz instability test \\ \hline

NTSI-2D  & 2D Non-linear thin shell instability test \\ \hline

POLYRAD1 & Masunaga \& Inutsuka (????) collapse test \\ \hline

SEDOV-3D & Sedov blast wave test (Sedov 19??). \\ \hline

SHEAR-2D & 2-D shearing layer test. \\ \hline

SIT1-AB  & A variation of the Boss-Bodenheimer (1979) test.  
           A uniform-density spherical cloud is given a sinusoidal azimuthal 
           density perturbation and a solid-body rotationaal velocity field 
           such that it collapses to form a dense filament with a star on 
           each end and eventually bound binary system. \\ \hline

STATPOLY1 & Relax a polytropic gas to hydrostatic balance. \\ \hline

\end{supertabular}
\end{center}

\newpage


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Coding style of SEREN}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Design philosophy of SEREN}
SEREN is a highly modular code written in Fortran 90 which comprises of several layers of subroutine calls in performing basic simulations.  Each subroutine is designed to perform one single task.  If a long procedure consists of a number of independent steps (i.e. not using the same local variables), then it is broken down into a sequence of smaller subroutines.  Also, each \var{.F90} file contains one single subroutine (with the exception of \var{sanitycheck.F90} which has two extra smaller subroutines for clarity).

For the benefit of anyone reading through the source code, or for those wishing to develop new routines, we discuss here in detail some of the more important coding conventions that are used in SEREN.  We do not discuss the particular features of any one subroutine (since each routine is extensively commented), but focus on the style used in most subroutines of SEREN.  


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Macros} \label{SS:MACROS}
SEREN uses C-like macros throughout the source code, both for the clarity (by reducing the number of lines) and the efficiency and runtime speed of the code.  Macros are strings (conventionally in upper case as in C) which are substituted for some user-defined value or expression by the {\it pre-processor}, i.e. before the compiler generates machine code from the source code.  This can improve the runtime performance somewhat by removing common variable references.  

Macros are defined in two separate locations in SEREN.  Some are defined in the Makefile (e.g. \var{NDIM}). Most macros however are defined in the header file \var{/headers/macros.h}.  In order to make use of the macros, we must import the file \var{/headers/macros.h} into the subroutine by way of the pre-processor command \var{\#include ``macros.h''}.  The majority of macros in SEREN are straight-forward numerical substitutions of important information, such as array sizes or physical constants.



%%\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Function-like macros}
Function-like macros are macros that look like functions/subroutines by their syntax, but work by the substitution of a string of commands, rather than calling a subroutine elsewhere in memory (thereby eliminating the extra cost associated with a subroutine call).  In SEREN, we use function-like macros as a compact and concise way of writing debugging information to the screen when in debug mode.  For example, we define the \var{debug1} macro in the following way. \newline

\noindent \var{\#ifdef DEBUG1} \\
\var{\#define debug1(x)   write (6,*) x} \\
\noindent\var{\#else} \\
\var{\#define debug1(x)} \\
\noindent\var{\#endif} \newline

If we wished to write debug information to screen (e.g. in order to indicate the current location in the code), we could write in long-hand: \newline

\noindent \var{\#ifdef DEBUG1} \\ 
\var{write(6,*) ``Calculating smoothing lengths''} \\ 
\noindent\var{\#endif} \newline

In SEREN, we can instead write the short-hand form
\newline

\noindent \var{debug1(``Calculating smoothing lengths'')}
\newline

If the DEBUG1 compiler flag is defined in the Makefile, then the 
\var{debug1()} macro is replaced with 
\var{write(6,*) ``Calculating smoothing lengths''}.  
If DEBUG1 is not defined in the Makefile, then \var{debug1()} macro is replaced with nothing. For subroutines (particularly those in development) that contain many debugging statements, these macros allow us to write code with more clarity and fewer lines. We use four levels of debug macros, which are all defined in \var{/headers/macros.h}. 



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Real variable types} \label{SS:VARTYPES}
Rather than hard-wiring in the precision of real variables in the source code, SEREN allows the user to specify the precision through one of the options in the Makefile (PRECISION).  The precision is controlled by several lines in the module \var{definitions} (in \var{modules.F90}) : \newline

\indent \var{integer, parameter :: DP = selected\_real\_kind(p=15)} \\
\indent \var{integer, parameter :: SP = selected\_real\_kind(p=6)}  \\ 

\noindent \var{\#if defined(DOUBLE\_PRECISION)} \\
\indent \var{integer, parameter :: PR = DP} \\
\noindent \var{\#else}\\
\indent \var{integer, parameter :: PR = SP} \\
\noindent \var{\#endif}\newline


\noindent The first two lines use the intrinsic \var{selected\_real\_kind} function to define the precision independent of the processor type (i.e. whether it is 32-bit or 64-bit).  The conditional compilation section then defines the precision used in the code (i.e. \var{PR}) depending on the option selected in the Makefile.  Any real variable in the code must be defined in the following way, e.g. \newline

\indent \var{real(kind=PR) :: drmag} \newline

\noindent If we wish to declare a double or single precision variable irrespective of the general precision (e.g. any summation variables in \var{/main/diagnostics.F90} always use double precision), then we use \var{DP} or \var{SP} in place of \var{PR}. 

If we wish to convert a variable to a real variable of required precision, we must specify the kind (i.e. \var{PR}, \var{DP} or \var{SP}) as a second parameter in the \var{real} function, e.g. to convert the integer variable \var{i} to a real variable of precision \var{PR}, we write \newline

\indent \var{ireal = real(i,PR)} \\


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Particle data arrays} \label{SS:DATA}
SEREN mainly uses simple arrays to store particle data.  However, data which are important in gravity calculations are stored differently.  The position, mass and smoothing length information are grouped together in a single array, \var{parray(1:NDIM+2,1:ptot)}.  The position of particle \var{p} is stored in the elements \var{parray(1:NDIM,p)}, the mass is stored in the element \var{parray(MASS,p)}, and the smoothing length is stored in the element \var{parray(SMOO,p)} (See \var{/seren/headers/macros.h} for macro definitions). \newline


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Particle types}
SEREN accomodates the following particle types: 
\begin{itemize}
\item Static boundary particles (\var{pboundary})
\item Non-gravitating inter-cloud medium (IcM) particles (\var{picm})
\item Self-gravitating gas particles (\var{pgas})
\item Dark-matter particles (\var{pcdm})
\item Dust particles (\var{pdust})
\item Ion particles (\var{pion})
\item Sink particles (\var{stot})
\end{itemize}
where the variable names indicate the number of each particle type present 
in the simulation.  All data for the first three (boundary, IcM and self-gravitating gas particles) are stored in the main arrays, which contain \var{ptot} elements where $\var{ptot} = \var{pboundary} + \var{picm} + \var{pgas} + \var{pcdm} + \var{pdust} + \var{pdust}$.   
The data is stored such that the first \var{pboundary} elements contain the 
information for boundary particles, the next \var{picm} elements contain the 
information for the IcM particles, and the next \var{pgas} elements 
contain the information for the gas particles, and the final \var{pcdm} elements contain the information for the cdm particles.  Although provision has been made for their use in future versions of SEREN, dust and ion particles are not currently active.  

The sink particles are stored in separate data structures, since they can have many additional properties that are not possessed by normal SPH particles and thus require their own data structures.  We use Fortran \var{types} (equivalent to C structures) to hold sink data.  The main array that contains each sink structure is called \var{sinkdata} and elements can be accessed using the Fortran \% notation (e.g. the mass element of sink \var{s} is \var{sinkdata(s)\%m}).  


\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Units}
Dimensionless units are used in numerical simulations so that all values are as close to unity as possible, to avoid having very large or very small values that may result in significant rounding errors.  SEREN contains a flexible system of units which allows the user to select from a wide range of commonly used astrophysical units, or easily construct their own set of units.  All variables related to units and scaling are determined in \var{units.F90}.  Each quantity, \var{X}, has four scaling variables associated with it: \var{Xunit}, \var{Xscale}, \var{X\_SI} and \var{Xcgs}.


\begin{itemize}
\item \var{Xunit} is a string which contains the name of the unit that the quantity \var{X} is measured in; e.g. for length units, \var{runit} may take the values \var{pc}, \var{au}, \var{r\_sun}, etc.   All \var{Xunit} strings are defined in the parameters file.  The available options in version 1.0 of the code are given in the following table: 

\item \var{Xscale} is a real variable that allows us to convert between physical and code units.  In order to convert any variable from physical to code units (where the physical variable is measured in units specified by \var{Xunit}), then we divide the physical unit by \var{Xscale}.  Conversely, to convert any code variable to physical units, we multiply the code value by \var{Xscale}
%, i.e.
%\begin{eqnarray}
%\var{X}_{\rm code} &= \frac{\var{X}_{\rm physical}}{\var{Xscale}}
%\end{eqnarray}
\item \var{X\_SI} is a real variable that allows us to convert between the unit specified by \var{Xunit} and S.I. units.  In order to convert from \var{Xunit} to S.I. units, we multiply the variable (in units of \var{Xunit}) by \var{X\_SI}.
\item \var{Xcgs} is a real variable that allows us to convert between the unit specified by \var{Xunit} and cgs units.  In a similar way to converting to S.I. units, in order to convert from \var{Xunit} to cgs units, we multiply the variable (in units of \var{Xunit}) by \var{Xcgs}.
\end{itemize}


In a self-gravitating code like SEREN, we choose a set of units so as to make the gravitational constant $G$ equal to unity.   We are free to choose the values of \var{rscale} and \var{mscale}.  The value of \var{tscale} is then set to ensure \var{G = 1} in the new system of units.  Therefore, the value of \var{tscale} can be obtained using 
\begin{equation}
tscale \times t\_SI = \frac{\left( rscale \times r\_SI \right)^{3/2}} 
{\sqrt{G \times mscale \times m\_SI}}
\end{equation}
where \var{G} is the gravitational constant in c.g.s. units, i.e. $\var{G} = 6.67 \times 10^{-8} \, {\rm cm}^3\,{\rm g}^{-1}\,{\rm s}^{-2}$.  All other scaling factors can be determined in a similar way using: 
\begin{equation}
vscale \times v\_SI = \frac{rscale \times r\_SI} {tscale \times t\_SI}
\end{equation}

\begin{equation}
ascale \times a\_SI = \frac{rscale \times r\_SI} {\left(tscale \times t\_SI \right)^2}
\end{equation}

\begin{equation}
rhoscale \times rho\_SI = \frac{mscale \times m\_SI} {\left(rscale \times r\_SI \right)^3}
\end{equation}

\begin{equation}
sigmascale \times sigma\_SI = \frac{mscale \times m\_SI} {\left(rscale \times r\_SI \right)^2}
\end{equation}

\begin{equation}
Pscale \times P\_SI = \frac{mscale \times m\_SI} {rscale \times r\_SI \times \left( tscale \times t\_SI \right)^2}
\end{equation}

\begin{equation}
fscale \times f\_SI = \frac{mscale \times m\_SI \times rscale \times r\_SI} {\left( tscale \times t\_SI \right)^2}
\end{equation}

\begin{equation}
Escale \times E\_SI = \frac{mscale \times m\_SI \times  rscale \times r\_SI} {\left( tscale \times t\_SI \right)^2}
\end{equation}

\begin{equation}
momscale \times mom\_SI = \frac{mscale \times m\_SI \times rscale \times r\_SI} {tscale \times t\_SI}
\end{equation}

\begin{equation}
angmomscale \times angmom\_SI = \frac{mscale \times m\_SI \times rscale^2 \times r\_SI^2}{tscale \times t\_SI}
\end{equation}
 
\begin{equation}
dmdtscale \times dmdt\_SI = \frac{mscale \times m\_SI}{tscale \times t\_SI}
\end{equation}

\begin{equation}
Lscale \times L\_SI = \frac{Escale \times E\_SI}{tscale \times t\_SI}
\end{equation}

\begin{equation}
kappascale \times kappa\_SI = \frac{\left(rscale \times r\_SI \right)^2}{mscale \times m\_SI}
\end{equation}

In MHD, we must also introduce the unit of charge and associated units such as magnetic field and current density.  As with gravitational problems, we can scale the units of the magnetic field such that the permiability of free space, $\mu_{0}$, is equal to unity.  {\bf to be completed}.

\begin{equation}
Jscale \times J\_SI = \frac{Qscale \times Q\_SI}
{tscale \times t\_SI \times rscale^2 \times r\_SI^2}
\end{equation}
\newline


\tablecaption{List of unit options in SEREN}
\tablehead{\hline \bf{Xunit}      & \bf{Options}    & \bf{Description}  \\ \hline}
\tabletail{\hline}
\tablelasttail{\hline}
%\begin{figure}
\begin{center}
\begin{supertabular}{|p{3cm}|p{3cm}|p{6cm}|}
\var{runit}     & \var{mpc}       & megaparsecs \\
                & \var{kpc}       & kiloparsecs \\
                & \var{pc}        & parsecs \\
                & \var{au}        & astronomical units \\
                & \var{r\_sun}    & solar radii \\
                & \var{r\_earth}  & Earth radii \\
                & \var{km}        & kilometres \\
                & \var{m}         & metres \\
                & \var{cm}        & centimetres \\ \hline
\var{munit}     & \var{m\_sun}    & solar masses \\ 
                & \var{m\_jup}    & Jupiter masses \\
                & \var{m\_earth}  & Earth masses \\
                & \var{kg}        & kilograms \\
                & \var{g}         & grams \\ \hline
\var{tunit}     & \var{gyr}       & gigayears \\
                & \var{myr}       & megayears \\
                & \var{yr}        & years \\
                & \var{day}       & days \\
                & \var{sec}       & seconds \\ \hline
\var{vunit}     & \var{km\_s}     & kilometres per second  \\
                & \var{au\_yr}    & astronomical units per year \\
                & \var{m\_s}      & metres per second \\
                & \var{cm\_s}     & centimetres per second \\ \hline
\var{aunit}     & \var{km\_s2}    & kilometres per second squared \\
                & \var{au\_yr2}   & astronomical units per year squared \\
                & \var{m\_s2}     & metres per second squared \\
                & \var{cm\_s2}    & centimetres per second squared \\ \hline
\var{rhounit}   & \var{m\_sun\_pc3} & solar masses per cubic parsec \\
                & \var{g\_cm3}     & grams per cubic centimetre \\ \hline
\var{sigmaunit} & \var{m\_sun\_pc2} & solar masses per parsec squared \\
                & \var{g\_cm2}     & grams per centimetre squared \\ \hline
\var{Punit}     & \var{Pa}        & pascals \\
                & \var{bar}       & bars \\
                & \var{g\_cms2}    & grams per centimetre per second squared \\
\hline
\var{funit}     & \var{N}         & newtons  \\ 
                & \var{dyn}       & dynes    \\ \hline
\var{Eunit}     & \var{J}         & joules \\
                & \var{erg}       & ergs \\
                & \var{GJ}        & gigajoules \\ \hline
\var{momunit}   & \var{m\_sunkm\_s} & solar masses kilometres per second \\
                & \var{m\_sunau\_yr}& solar masses astronomical units per year \\
                & \var{kgm\_s}    & kilomgram metres per second \\
\hline
\var{angmomunit}& \var{kgm2\_s}  & kilogram metres squared per second \\
                & \var{gcm2\_s}   & gram centimetres squared per second \\ 
\hline
\var{angvelunit}& \var{rad\_s}   & radians per second \\
\hline
\var{dmdtunit}  & \var{m\_sun\_myr} & solar masses per megayear \\
                & \var{m\_sun\_yr}  & solar masses per year \\
                & \var{kg\_s}       & kilograms per second \\
                & \var{g\_s}        & grams per second \\ \hline
\var{Lunit}     & \var{L\_sun}    & solar luminosities \\ \hline
\var{kappaunit} & \var{m2\_kg}    & metre squared per kilogram \\
                & \var{cm\_g}     & centimetre per gram \\ 
\hline
\var{Bunit}     & \var{tesla}     & tesla \\
                & \var{gauss}     & gauss \\
\hline
\var{Qunit}     & \var{C}         & coulombs \\
\hline
\var{Junit}     & \var{C\_m2\_s}  & coulombs per second per metre squared \\
\hline
\var{uunit}     & \var{J\_kg}     & Joules per kilogram \\
                & \var{erg\_g}    & ergs per gramme \\ \hline
\var{dudtunit}  & \var{J\_kg\_s}  & Joules per kilogram per second \\ \hline
\var{tempunit}  & \var{K}         & kelvin \\
\end{supertabular}
\end{center}


\newpage


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{File formats}
SEREN \VERNO uses both the DRAGON file format and the native SEREN file format for reading in initial conditions and writing out snapshots.  Unlike in DRAGON, the format of the initial conditions file need not be the same as the format of the output snapshots.  This is controlled by the two input parameters in the parameters file, \var{in\_file\_form} and \var{out\_file\_form}.  The possible values for these parameters are : 
\begin{itemize}
\item \var{ascii} - Simple (ASCII) column format
\item \var{dragon\_form} - Formatted (ASCII) DRAGON snapshot files
\item \var{dragon\_unform} - Unformatted (binary) DRAGON snapshot files
\item \var{seren\_form} - Formatted (ASCII) SEREN snapshot files
\item \var{seren\_unform} - Unformatted (binary) SEREN snapshot files (Not yet working)
\end{itemize}

As well as standard snapshot files, SEREN can also produce a simple ASCII output which is useful for debugging purposes.  This can be enabled by using the {\rm -DDEBUG\_PLOT\_DATA} compiler flag.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{ASCII format}
Seren can use a simple flexible ASCII column-format.  The data is stored in columns with width $N_{_{\rm COLUMNS}}$ and length $N$ (where $N$ is the total number of particles of all types).  The data descriptor of each column is contained in a file labelled \var{asciicolumns.dat} (a template copy should be stored in the \var{/datafiles} sub-directory).  The possible data descriptors currently enabled in SEREN are
\begin{itemize} 
\item \var{ptype} - Particle type.  The following particle types are available in SEREN : 
\begin{itemize}
\item -1 : sink/star
\item  0 : dead particle
\item  1 : gas
\item  6 : boundary particle
\item  9 : ICM particle
\item 10 : cold-dark matter particle
\end{itemize}
\item \var{x} or \var{y} or {z} - Cartesian position coordinates
\item \var{vx} or \var{vy} or \var{vz} - Cartesian velocity components
\item \var{h} - Smoothing length
\item \var{m} - Mass
\item \var{u} - Specific internal energy
\item \var{temp} - Temperature (in K)
\end{itemize}
The only constraint on the column order is that the first column must be \var{ptype}.  Thereafter, the remaining columns can be arranged in any order.  In the file containing the data, the data must match up to the chosen columns correctly, or the particle data will be read-in incorrectly.  All physical quantities are measured in the units defined in the \var{params.dat} file.  Due to the simplicity of this format, it contains no extra information (e.g. time, gamma, etc.), and therefore is perhaps not of long-term practical use, but should be suitable for those who wish to generate their own initial conditions from other programmes without learning all the complications of the other available formats.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Dragon format}
To be written



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Seren format}
To be written




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Structure of code}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Basic directory structure}
Subroutines in SEREN are not all contained in a single source directory, 
but are grouped in several sub-directories depending on their purpose. 
In version 1.0, the following sub-directories exist : 
\begin{itemize}
\item \var{/seren/src/advance} - integration routines
\item \var{/seren/src/analyse} - analysis routines
\item \var{/seren/src/BHtree} - Barnes-Hut octal tree subroutines
\item \var{/seren/src/binarytree} - Binary-number tree subroutines
\item \var{/seren/datafiles} - Contains initial conditions parameters files
\item \var{/seren/docs} - Contains latest version of the userguide
\item \var{/seren/src/gravity} - subroutines that calculate gravitational forces
\item \var{/seren/src/headers} - macro and modules files
\item \var{/seren/src/healpix} - HEALPix ioniaztion routines
\item \var{/seren/src/ic} - programs to generate initial conditions for 
regularly used configurations (e.g. relaxed rectangular cubes, 
spheres)
\item \var{/seren/src/io} - subroutines that read and write files
\item \var{/seren/src/main} - contains important and commonly used 
subroutines
\item \var{/seren/src/mhd} - contains magneto-hydrodynamics routines
\item \var{/seren/src/nbody} - N-body routines
\item \var{/seren/src/nbody\_sim} - N-body simulation subroutines
\item \var{/seren/src/nbody\_sph\_sim} - Hybrid N-body/SPH simulation routines
\item \var{/seren/src/radiation} - contains radiation transfer subroutines
\item \var{/seren/src/setup} - contains subroutines called during initialization of SEREN .
\item \var{/seren/src/sinks} - subroutines that search for, create and 
advance sink particles. 
\item \var{/seren/src/sorts} - subroutines for sorting lists
\item \var{/seren/src/sph} - subroutines that perform important SPH functions 
\item \var{/seren/src/sph\_sim} - SPH simulation routines
(e.g. h-finding, neighbour searching)  
\item \var{/seren/src/tests} - test programs
\item \var{/seren/src/timestep} - timestepping routines
\item \var{/seren/testsuite} - bash script for running batch tests of seren
\end{itemize}


%\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Variable conventions}
In SEREN, the names of all commonly used local variables are kept as 
consistent as possible between different subroutines.  
Here we list the names of all common local integer and real variables.  

\subsection{Integer variables}
\begin{tabular}{lll}
\var{c}  &  &  Cell identifier \\
\var{cc} &  &  Child cell identifier \\
\var{i}  &  &  Auxiliary counter (often used when looping over neighbour lists) \\
\var{k}  &  &  Dimension counter \\
\var{l}  &  &  Level counter (for BH tree and HEALPix) \\
\var{p}  &  &  Particle identifier  \\
\var{pp} &  &  Neighbour identifier \\
\var{pp\_pot} & & No. of potential neighbours (e.g. after a tree walk) \\
\var{pp\_templist(1:pp\_limit)} &  & Temporary list of neighbour identifiers \\
\var{pp\_tot} & & Total number of neighbours for particle p \\
\var{s}  &  &  Sink particle identifier \\
\var{ss} &  &  Secondary sink counter
\end{tabular}

\subsection{Real variables}
\begin{tabular}{lll}
\var{dr(1:NDIM)}  &  &  Relative position vector \\
\var{drmag}       &  &  Distance \\
\var{drsqd}       &  &  Distance squared \\
\var{dr\_unit(1:NDIM)} &  &  Unit position vector \\
\var{hp}          &  &  Smoothing length of particle p \\
\var{hpp}         &  &  Smoothing length of neighbouring particle pp \\
\var{mp}          &  &  Mass of particle p \\
\var{mpp}         &  &  Mass of neighbouring particle pp \\
\var{ms}          &  &  Mass of sink particle s \\
\var{invdrmag}    &  &  Reciprocal of distance, i.e. 1 / drmag \\
\var{invdrsqd}    &  &  Reciprocal of distance squared, i.e. 1 / drsqd \\
\var{invhp}       &  &  Reciprical of smoothing length of p, i.e. 1 / hp \\
\var{invhpp}      &  &  Reciprical of smoothing length of pp, i.e. 1 / hpp \\
\var{qc(1:NQUAD)} &  &  Quadrupole moment tensor for cell c \\
\var{rp(1:NDIM)}  &  &  Position of particle p \\
\var{rpp(1:NDIM)} &  &  Position of neighbouring particle pp  \\
\var{rs(1:NDIM)}  &  &  Position of sink particle s \\
\var{sound\_p}    &  &  Sound speed of particle p \\
\var{sound\_pp}   &  &  Sound speed of neighbouring particle pp \\
\var{up}          &  &  Specific internal energy of particle p \\
\var{upp}         &  &  Specific internal energy of neighbouring particle pp \\
\var{vp(1:NDIM)}  &  &  Velocity of particle p \\
\var{vpp(1:NDIM)} &  &  Velocity of neighbouring particle pp \\
\var{vs(1:NDIM)}  &  &  Velocity of sink particle s \\
\end{tabular}



\end{document}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

